# Niantic Studio トゥーンシェーダー

- 詳細記事は[こちら](https://toyaworks.substack.com/p/8thwall-33b)をお読みください

Niantic Studio（旧8th Wall Studio）用のカスタムトゥーン/セルシェーディング効果コンポーネントです。3Dモデルを漫画やアニメのようなスタイライズされた見た目に変換します。

[English README](README.md) | **日本語**

## 特徴

- **セルシェーディング/トゥーンライティング効果** - カスタマイズ可能なパラメータ付き
- **テクスチャ保持** - 元の色とテクスチャを維持
- **調整可能な強度** - リアルなライティングとトゥーンライティングのブレンド
- **設定可能なステップ数** - ライティングのグラデーション段階数を制御
- **安全な実装** - システムコンポーネントとの競合を回避

## デモ

リアルな3Dモデルをスタイライズされたアニメ風ビジュアルに変換：

- 変換前：標準的なPBRライティング
- 変換後：テクスチャを保持したステップライティング

## インストール方法
1. **Niantic Studioにアップロード**
   - Niantic Studioプロジェクトを開く
   - `toon-postprocess.js`を**Assets**セクションにドラッグ&ドロップ

2. **シーンに適用**
   - Hierarchyで**Camera**エンティティを選択
   - Inspectorで**Add Component**をクリック
   - **Custom Component** → **toon-postprocess**を選択

## パラメータ

| パラメータ | 型 | 範囲 | デフォルト | 説明 |
|-----------|------|-------|---------|-------------|
| `intensity` | Float | 0.0 - 1.0 | 0.8 | トゥーン効果の強度（0.0 = リアル、1.0 = 完全トゥーン） |
| `steps` | Float | 2.0 - 8.0 | 4.0 | ライティングステップ数（2.0 = シャープ、8.0 = スムーズ） |

## 使用例

### 基本セットアップ
```javascript
// コンポーネントをCameraエンティティに追加すると自動的に適用されます
// Inspectorパネルでパラメータを調整してください
```

### 推奨設定

**アニメ/マンガスタイル：**
- Intensity: `0.9`
- Steps: `3.0`

**ソフトなトゥーン：**
- Intensity: `0.6`
- Steps: `6.0`

**ハイコントラスト：**
- Intensity: `1.0`
- Steps: `2.0`

## 技術的詳細

### 動作原理

シェーダーはシーン内のすべてのメッシュオブジェクトにカスタム**フラグメントシェーダー**を適用します：

1. **テクスチャサンプリング**: 元のディフューズテクスチャとベースカラーを保持
2. **ライティング計算**: サーフェス法線と光の方向の内積を計算
3. **ステップ量子化**: `steps`パラメータに基づいてライティングを離散的なステップに分割
4. **強度ブレンド**: `intensity`パラメータに基づいて元のライティングとステップライティングをミックス

### シェーダー機能

- **頂点シェーダー**: 法線とUV座標を通す
- **フラグメントシェーダー**: 
  - テクスチャ対応カラーサンプリング
  - ステップライティング計算
  - uniformsによる設定可能パラメータ
  - 最小輝度のクランプ

### 対応環境

- ✅ **Niantic Studio**（最新版）
- ✅ **Three.js r128+**
- ✅ **WebGL 1.0/2.0**
- ✅ **GLB/GLTFモデル**
- ✅ **テクスチャ付き/なしマテリアル**
